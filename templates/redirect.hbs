<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{site.name}} - {{meta.title}}</title>

    <!-- Preload critical resources -->
    <link rel="preload" href="/css/critical.css" as="style">
    <link rel="preconnect" href="{{site.baseUrl}}">
    <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
    
    <!-- Google tag (gtag.js) - Moved to bottom for better performance -->
    <script async src="https://www.googletagmanager.com/gtag/js?id={{site.googleAnalytics}}" defer></script>
    
    <!-- Favicon Links - Consolidated -->
    <link rel="apple-touch-icon" sizes="180x180" href="/img/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img/favicons/favicon-16x16.png">
    <link rel="manifest" href="/img/favicons/site.webmanifest">
    <link rel="mask-icon" href="/img/favicons/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="/img/favicons/favicon.ico">
    <meta name="msapplication-TileColor" content="{{meta.msapplicationTileColor}}">
    <meta name="msapplication-config" content="/img/favicons/browserconfig.xml">
    <meta name="theme-color" content="{{meta.themeColor}}">

    <!-- Enhanced SEO Meta Tags -->
    <meta name="description" content="{{meta.description}}">
    <meta name="keywords" content="{{meta.keywords}}">
    <meta name="author" content="{{meta.author}}">
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    
    <!-- Open Graph Tags - Enhanced -->
    <meta property="og:title" content="{{meta.title}}">
    <meta property="og:description" content="{{meta.description}}">
    <meta property="og:image" content="{{site.baseUrl}}{{og.image}}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:url" content="{{site.baseUrl}}">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="{{site.name}}">
    <meta property="og:locale" content="{{og.locales.default}}">
    {{#each og.locales.alternates}}
    <meta property="og:locale:alternate" content="{{this}}">
    {{/each}}

    <!-- Twitter Card Tags - Enhanced -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="{{site.twitter}}">
    <meta name="twitter:creator" content="{{site.twitter}}">
    <meta name="twitter:title" content="{{meta.title}}">
    <meta name="twitter:description" content="{{meta.description}}">
    <meta name="twitter:image" content="{{site.baseUrl}}{{og.image}}">
    <meta name="twitter:image:alt" content="{{meta.imageAlt}}">

    <!-- Canonical URL -->
    <link rel="canonical" href="{{site.baseUrl}}">

    <!-- Improved Hreflang Tags -->
    {{#each languages}}
    <link rel="alternate" hreflang="{{code}}" href="{{../site.baseUrl}}/{{code}}/">
    {{/each}}
    <link rel="alternate" hreflang="x-default" href="{{site.baseUrl}}/en/">

    <!-- Enhanced Schema Markup with BreadcrumbList -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "{{site.name}}",
        "url": "{{site.baseUrl}}",
        "description": "{{meta.description}}",
        "potentialAction": {
          "@type": "SearchAction",
          "target": "{{site.baseUrl}}/search?q={search_term_string}",
          "query-input": "required name=search_term_string"
        },
        "publisher": {
          "@type": "Organization",
          "name": "{{site.name}}",
          "logo": {
            "@type": "ImageObject",
            "url": "{{site.baseUrl}}/img/logo.png",
            "width": "600",
            "height": "60"
          }
        }
      }
    </script>
    
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "name": "Home",
            "item": "{{site.baseUrl}}"
          }
        ]
      }
    </script>

    <!-- Inline critical CSS -->
    <style>

      @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap&text=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&display=swap');

      html {
    font-size: 16px;
    line-height: 1.5;
    -webkit-text-size-adjust: 100%;
    font-family: 'Poppins', var(--font-sans), ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    font-feature-settings: normal;
    font-variation-settings: normal;
    -moz-tab-size: 4;
    tab-size: 4;
    /* Make all content non-selectable */
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    /* Improve rendering */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    /* Improve accessibility */
    scroll-behavior: smooth;
}

/* Improve focus visibility for accessibility and SEO */
:focus {
    outline: 2px solid #dd98ff;
    outline-offset: 2px;
}

/* Add print styles for better SEO */
@media print {
    body {
        background-color: transparent;
        color: #000;
    }
    
    .social-btn {
        border: 1px solid #000;
        background-image: none;
    }
}
body {
    background-color: #101218;
    color: #f2f4f9;
    font-family: 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif;
    font-size: 16px;
    font-weight: 400;
    margin: 0;
    padding: 0;
    min-height: 100vh;
    overflow-x: hidden;
    /* Prevent text selection */
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}
      .redirect-container {
        text-align: center;
        margin: 50px auto;
        max-width: 600px;
        padding: 20px;
      }
      .language-list {
        list-style: none;
        padding: 0;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 15px;
        margin-top: 30px;
      }
      .language-list li a {
        display: inline-block;
        padding: 10px 20px;
        background-color: #f5f5f5;
        color: #333;
        text-decoration: none;
        border-radius: 4px;
        transition: background-color 0.2s ease;
      }
      .language-list li a:hover {
        background-color: #e0e0e0;
      }
      [dir="rtl"] .language-list {
        flex-direction: row-reverse;
      }
    </style>

    <!-- Improved Redirection Script with better performance -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Google Analytics
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', '{{site.googleAnalytics}}', { 'anonymize_ip': true });
        
        // Language redirection
        const path = window.location.pathname;
        if (path.match(/^\/(en|fr|ar|de)\//)) {
          return;
        }
        
        const lang = navigator.language || navigator.userLanguage || 'en';
        let redirectUrl = '/en/';
        
        if (lang.startsWith('fr')) redirectUrl = '/fr/';
        else if (lang.startsWith('ar')) redirectUrl = '/ar/';
        else if (lang.startsWith('de')) redirectUrl = '/de/';
        
        const savedLang = localStorage.getItem('preferred-language');
        if (savedLang) {
          redirectUrl = '/' + savedLang + '/';
        }
        
        window.location.href = redirectUrl;
      });
    </script>
</head>
<body>
    <div class="redirect-container" role="main">
        <h1>Redirecting...</h1>
        <p>If you are not redirected automatically, please select your preferred language:</p>
        
        <!-- Fallback Language Links with improved accessibility -->
        <ul class="language-list" aria-label="Language selection">
            {{#each languages}}
            <li>
                <a href="/{{code}}/" 
                   onclick="localStorage.setItem('preferred-language', '{{code}}')"
                   lang="{{code}}"
                   hreflang="{{code}}"
                   {{#if dir}}dir="{{dir}}"{{/if}}
                   aria-label="{{name}} language">
                    {{name}}
                </a>
            </li>
            {{/each}}
        </ul>
    </div>
</body>
</html>